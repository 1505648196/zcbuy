<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org">
<head>
	<meta charset="UTF-8">
	<title>欢迎</title>
	<meta name="renderer" content="webkit|ie-comp|ie-stand">
	<meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
	<meta name="viewport" content="width=device-width,user-scalable=yes,
				minimum-scale=0.4, initial-scale=0.8,target-densitydpi=low-dpi"/>
	<link rel="stylesheet" href="static/css/font.css">
	<link rel="stylesheet" href="static/layui/css/layui.css">
	<link rel="stylesheet" href="static/css/xadmin.css">
	<script src="static/layui/layui.js"></script>
	<script src="static/js/xadmin.js"></script>
	<!--[if lt IE 9]>
	<script src="https://cdn.staticfile.org/html5shiv/r29/html5.min.js"></script>
	<script src="https://cdn.staticfile.org/respond.js/1.4.2/respond.min.js"></script>
	<![endif]-->
</head>
<body style="overflow-y: scroll">

<div class="layui-container" style="margin-top: 20px;margin-right: 20px">
	<form class="layui-form">

		<div class="layui-form-item">
			<label class="layui-form-label">姓名：</label>
			<div class="layui-input-block">
				<input type="text" id="name" name="name" class="layui-input" lay-verify="required">
			</div>
		</div>

		<div class="layui-form-item">
			<label class="layui-form-label">单位：</label>
			<div class="layui-input-block">
				<select id="unitId" name="unitId" class="layui-input" lay-filter="change"  lay-verify="required"></select>
			</div>
		</div>

		<div class="layui-form-item">
			<label class="layui-form-label">部门：</label>
			<div class="layui-input-block">
				<select id="departmentId" name="departmentId" class="layui-input" lay-verify="required"></select>
			</div>
		</div>

		<div class="layui-form-item">
			<label class="layui-form-label">角色：</label>
			<div class="layui-input-block">
				<select name="roleId" id="roleId" class="layui-input" lay-verify="required"></select>
			</div>
		</div>

		<div class="layui-form-item">
			<label class="layui-form-label">手机：</label>
			<div class="layui-input-block">
				<input type="text" id="phone" name="phone" lay-verify="phone" class="layui-input">
			</div>
		</div>
		<div class="layui-form-item">
			<label class="layui-form-label">邮箱：</label>
			<div class="layui-input-block">
				<input type="text" id="email" name="email" lay-verify="email" class="layui-input">
			</div>
		</div>

		<div class="layui-form-item">
			<div class="layui-input-block">
				<button lay-submit class="layui-btn" id="sub" lay-filter="sub">提交</button>
			</div>
		</div>
		<input type="hidden" id="id"/>
		<input type="hidden" id="rid"/>
		<input type="hidden" id="uid"/>
		<input type="hidden" id="did"/>
	</form>
</div>
</body>

<script>
  layui.use(['layer', 'form', 'table', 'laydate'],
	  function () {
      var laydate = layui.laydate, //日期
      layer = layui.layer, //弹层
      form = layui.form;
      $ = layui.jquery; //jquery控件
      var id =$("#id").val();

      //单位下拉框
      $.get("getAllUnit",function (res) {
        var data=res.data;
        var id=$("#id").val()==null?-1:$("#uid").val();
        var html="";
        $.each(data,function (index,item) {
          if(id==item.id){
            html+="<option value='"+item.id+"' selected>"+item.name+"</option>";
          }else {
            html+="<option value='"+item.id+"'>"+item.name+"</option>";
          }
        });
        $("#unitId").html(html);
        form.render();
        getDepartment();
      });

      form.on('select(change)', function(data){
        getDepartment();
      });

      function getDepartment() {
        var params={"unitId":$("#unitId").val()};
        $.get("getDepartment",params,function (res) {
          var data=res.data;
          var id=$("#id").val()==null?-1:$("#did").val();
          var html="";
          $.each(data,function (index,item) {
            if(id==item.id){
              html+="<option value='"+item.id+"' selected>"+item.name+"</option>";
            }else {
              html+="<option value='"+item.id+"'>"+item.name+"</option>";
            }            });
          $("#departmentId").html(html);
          form.render();
        })
      }

      //角色下拉框
      $.get("getAllRole",function (res) {
        var data=res.data;
        var id=$("#id").val()==null?-1:$("#rid").val();
        var html="";
        $.each(data,function (index,item) {
          if(id==item.id){
						html+="<option value='"+item.id+"' selected>"+item.name+"</option>";
					}else {
						html+="<option value='"+item.id+"'>"+item.name+"</option>";
					}
        });
        $("#roleId").html(html);
        form.render();
      });

    form.on('submit(sub)',function (data) {

      $.post("updateUserInfo", data.field,
        function (res) {
          if(res.result){
            layer.msg('更新成功！', {
              time: 1000
            },function () {
              var index = parent.layer.getFrameIndex(window.name);
              parent.layer.close(index);
              parent.location.reload();
            });

          }else {
            layer.msg('更新失败！'+res.msg, {
              time: 1000
            });
          }
        });
      return false;
    });

  });
</script>
</html>